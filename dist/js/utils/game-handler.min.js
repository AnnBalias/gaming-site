class GameHandler{constructor(){this.iframe=null,this.fullscreenBtn=null,this.startBtn=null,this.retryBtn=null,this.adblockWarning=null,this.gameOverlay=null,this.loadAttempts=0,this.maxLoadAttempts=3,this.init()}init(){this.iframe=document.getElementById("game-iframe"),this.fullscreenBtn=document.getElementById("fullscreen-btn"),this.startBtn=document.getElementById("start-game-btn"),this.retryBtn=document.getElementById("retry-game-btn"),this.adblockWarning=document.getElementById("adblock-warning"),this.gameOverlay=document.getElementById("game-overlay"),((window.gameHandler=this).iframe||this.fullscreenBtn||this.startBtn)&&(this.setupEventListeners(),this.checkAdBlocker())}setupEventListeners(){this.fullscreenBtn&&this.fullscreenBtn.addEventListener("click",()=>this.toggleFullscreen()),this.startBtn&&this.startBtn.addEventListener("click",()=>this.startGame()),this.retryBtn&&this.retryBtn.addEventListener("click",()=>this.retryGame()),this.iframe&&(this.iframe.addEventListener("load",e=>this.onIframeLoad(e)),this.iframe.addEventListener("error",e=>this.onIframeError(e)))}checkAdBlocker(){let t=document.createElement("div");t.innerHTML="&nbsp;",t.className="adsbox",t.style.position="absolute",t.style.left="-10000px",document.body.appendChild(t),setTimeout(()=>{var e=0===t.offsetHeight;document.body.removeChild(t),e&&this.showAdBlockerWarning()},100)}showAdBlockerWarning(){this.adblockWarning&&(this.adblockWarning.style.display="block")}hideAdBlockerWarning(){this.adblockWarning&&(this.adblockWarning.style.display="none")}setupIframeFallback(){setTimeout(()=>{this.iframe&&!this.iframe.contentWindow&&this.handleLoadError("Iframe failed to load within timeout")},1e4)}onIframeLoad(e){this.loadAttempts=0,this.hideAdBlockerWarning();try{var t=this.iframe.contentDocument||this.iframe.contentWindow.document;t&&"complete"===t.readyState&&this.handleSuccessfulLoad()}catch(e){this.handleSuccessfulLoad()}}onIframeError(e){window.EnvironmentHelpers&&window.EnvironmentHelpers.shouldSilentFail("iframe error")||(console.error("Iframe error:",e),this.handleLoadError("Iframe failed to load"))}handleSuccessfulLoad(){this.gameOverlay&&(this.gameOverlay.style.display="none"),this.hideAdBlockerWarning()}handleLoadError(e){console.error("Game load error:",e),this.loadAttempts++,this.loadAttempts>=this.maxLoadAttempts?this.showAdBlockerWarning():this.retryGame()}retryGame(){if(this.iframe){1===this.loadAttempts?this.iframe.removeAttribute("sandbox"):2===this.loadAttempts&&this.iframe.setAttribute("sandbox","allow-scripts allow-same-origin");let e=this.iframe.src;this.iframe.src="",setTimeout(()=>{this.iframe.src=e},100)}}toggleFullscreen(){this.iframe&&(document.fullscreenElement?(document.exitFullscreen(),this.iframe.style.width="",this.iframe.style.height="",this.iframe.style.position="",this.iframe.style.top="",this.iframe.style.left="",this.iframe.style.zIndex=""):this.iframe.requestFullscreen().catch(e=>{console.warn("Fullscreen request failed:",e),this.iframe.style.width="100vw",this.iframe.style.height="100vh",this.iframe.style.position="fixed",this.iframe.style.top="0",this.iframe.style.left="0",this.iframe.style.zIndex="9999"}))}startGame(){if(this.iframe){this.gameOverlay&&(this.gameOverlay.style.display="none"),this.iframe.style.display="block",this.iframe.focus();try{this.iframe.contentWindow.postMessage({type:"START_GAME",source:"parent"},"*")}catch(e){console.warn("Could not send message to iframe:",e)}}}}document.addEventListener("DOMContentLoaded",()=>{new GameHandler});