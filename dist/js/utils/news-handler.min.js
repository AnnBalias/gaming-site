class NewsHandler{constructor(){this.newsData=null,this.currentNewsIndex=null,this.init()}init(){this.setupEventListeners(),this.waitForDataAndRender()}waitForDataAndRender(){if(window.gameData)this.loadNewsData(),this.renderNewsPage(),this.renderNewsSection();else{let e=()=>{window.gameData?(this.loadNewsData(),this.renderNewsPage(),this.renderNewsSection()):setTimeout(e,100)};e()}}setupEventListeners(){document.addEventListener("click",e=>{e.target.classList.contains("read-more-btn")&&(e=e.target.closest(".news-item, .news-page-item"))&&(e=parseInt(e.dataset.index),this.showNewsModal(e))}),document.addEventListener("click",e=>{(e.target.classList.contains("news-modal")||e.target.classList.contains("modal-close"))&&this.hideNewsModal()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.hideNewsModal()})}loadNewsData(){window.gameData&&window.gameData.news&&window.gameData.news.articles?this.newsData=window.gameData.news.articles:window.gameData&&window.gameData.news&&window.gameData.news.items?this.newsData=window.gameData.news.items:this.newsData=[{title:"New Song Pack Released!",date:"2025-01-15",excerpt:"Experience 10 new challenging songs with unique rhythms and beats. Available now for all players!",content:"We're excited to announce the release of our latest song pack featuring 10 brand new tracks that will test your rhythm skills to the limit. Each song has been carefully crafted to provide a unique challenge while maintaining the fun and addictive gameplay that players love."},{title:"Tournament Season 3 Begins",date:"2025-01-10",excerpt:"Join the competitive scene and compete against players worldwide. Prizes and recognition await!",content:"The highly anticipated Tournament Season 3 is now live! Compete against players from around the world in weekly challenges and monthly championships. Top performers will receive exclusive rewards and recognition on our global leaderboards."},{title:"Community Update",date:"2025-01-05",excerpt:"We've listened to your feedback and implemented several improvements to enhance your gaming experience.",content:"Based on your valuable feedback, we've made significant improvements to the game including enhanced graphics, smoother gameplay, and new accessibility features. We're committed to making the best rhythm gaming experience possible."},{title:"New Features Coming Soon",date:"2025-01-01",excerpt:"Get ready for exciting new features including custom song creation and multiplayer modes!",content:"We're working hard on bringing you amazing new features including a custom song creator that will let you make your own tracks, multiplayer modes for playing with friends, and enhanced social features. Stay tuned for more updates!"}]}renderNewsPage(){var e=document.getElementById("news-page-list");e&&this.newsData&&(e.innerHTML=this.newsData.map((e,t)=>`
      <article class="news-page-item" data-index="${t}">
        <div class="news-page-item__content">
          <h3 class="news-page-item__title">${e.title}</h3>
          <div class="news-page-item__meta">
            <span class="news-page-item__date">${new Date(e.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}</span>
          </div>
          <p class="news-page-item__excerpt">${e.excerpt}</p>
          <button class="btn btn--primary read-more-btn">Read More</button>
        </div>
      </article>
    `).join(""),this.addNewsPageStyles())}renderNewsSection(){var e,t=document.getElementById("news-list");t&&this.newsData&&(e=this.newsData.slice(0,3),t.innerHTML=e.map((e,t)=>`
      <article class="news-item" data-index="${t}">
        <div class="news-item__content">
          <h3 class="news-item__title">${e.title}</h3>
          <div class="news-item__meta">
            <span class="news-item__date">${new Date(e.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}</span>
          </div>
          <p class="news-item__excerpt">${e.excerpt}</p>
          <button class="btn btn--primary read-more-btn">Read more</button>
        </div>
      </article>
    `).join(""),this.addMoreNewsButton())}addMoreNewsButton(){var t,a=document.querySelector(".news");if(a){let e=a.querySelector(".news__footer");e||(t=a.querySelector(".news__content"))&&((e=document.createElement("div")).className="news__footer",t.appendChild(e)),e?e.innerHTML='<a href="news.html" class="btn btn--primary">More news</a>':(t=a.querySelector(".news__content"))&&((a=document.createElement("div")).className="news__footer",a.innerHTML='<a href="news.html" class="btn btn--primary">More news</a>',t.appendChild(a))}}addNewsPageStyles(){var e;document.getElementById("news-page-styles")||((e=document.createElement("style")).id="news-page-styles",e.textContent=`
      .news-page-item {
        background: white;
        border-radius: 16px;
        padding: 28px;
        margin-bottom: 28px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }
      
      .news-page-item:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
      }
      
      .news-page-item__title {
        font-size: 26px;
        font-weight: 700;
        color: #333;
        margin: 0 0 16px 0;
        line-height: 1.3;
      }
      
      .news-page-item__meta {
        margin-bottom: 18px;
      }
      
      .news-page-item__date {
        color: #666;
        font-size: 14px;
        font-weight: 500;
      }
      
      .news-page-item__excerpt {
        color: #555;
        line-height: 1.7;
        margin-bottom: 24px;
        font-size: 16px;
      }
      
      .read-more-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 14px 28px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }
      
      .read-more-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
      }

      /* Mobile styles for screens 540px and below */
      @media (max-width: 540px) {
        .news-page-item {
          border-radius: 12px;
          padding: 20px;
          margin-bottom: 20px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }
        
        .news-page-item:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }
        
        .news-page-item__title {
          font-size: 20px;
          margin: 0 0 12px 0;
          line-height: 1.4;
        }
        
        .news-page-item__meta {
          margin-bottom: 14px;
        }
        
        .news-page-item__date {
          font-size: 13px;
        }
        
        .news-page-item__excerpt {
          line-height: 1.6;
          margin-bottom: 18px;
          font-size: 15px;
        }
        
        .read-more-btn {
          padding: 12px 24px;
          font-size: 14px;
          border-radius: 6px;
        }
      }

      /* Extra small screens */
      @media (max-width: 360px) {
        .news-page-item {
          padding: 16px;
          margin-bottom: 16px;
          border-radius: 10px;
        }
        
        .news-page-item__title {
          font-size: 18px;
          margin: 0 0 10px 0;
        }
        
        .news-page-item__meta {
          margin-bottom: 12px;
        }
        
        .news-page-item__date {
          font-size: 12px;
        }
        
        .news-page-item__excerpt {
          margin-bottom: 16px;
          font-size: 14px;
        }
        
        .read-more-btn {
          padding: 10px 20px;
          font-size: 13px;
        }
      }
    `,document.head.appendChild(e))}showNewsModal(e){window.gameData&&window.gameData.news&&window.gameData.news.articles?this.newsData=window.gameData.news.articles:window.gameData&&window.gameData.news&&window.gameData.news.items?this.newsData=window.gameData.news.items:this.newsData=[{title:"New Song Pack Released!",date:"2025-01-15",excerpt:"Experience 10 new challenging songs with unique rhythms and beats. Available now for all players!",content:"We're excited to announce the release of our latest song pack featuring 10 brand new tracks that will test your rhythm skills to the limit. Each song has been carefully crafted to provide a unique challenge while maintaining the fun and addictive gameplay that players love."},{title:"Tournament Season 3 Begins",date:"2025-01-10",excerpt:"Join the competitive scene and compete against players worldwide. Prizes and recognition await!",content:"The highly anticipated Tournament Season 3 is now live! Compete against players from around the world in weekly challenges and monthly championships. Top performers will receive exclusive rewards and recognition on our global leaderboards."},{title:"Community Update",date:"2025-01-05",excerpt:"We've listened to your feedback and implemented several improvements to enhance your gaming experience.",content:"Based on your valuable feedback, we've made significant improvements to the game including enhanced graphics, smoother gameplay, and new accessibility features. We're committed to making the best rhythm gaming experience possible."}],0<=e&&e<this.newsData.length&&(this.currentNewsIndex=e,e=this.newsData[e],this.createNewsModal(e))}createNewsModal(e){this.hideNewsModal();let t=document.createElement("div");t.className="news-modal";var a=(e.content||e.excerpt).length;t.innerHTML=`
       <div class="modal-content ${500<a?"modal-content--scrollable":"modal-content--no-scroll"}">
         <div class="modal-header">
           <h2>${e.title}</h2>
           <button class="modal-close" type="button" aria-label="Close modal">&times;</button>
         </div>
         <div class="modal-body">
           <div class="news-meta">
             <span class="news-date">${new Date(e.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}</span>
           </div>
           <div class="news-content">
             <p>${e.content||e.excerpt}</p>
           </div>
         </div>
       </div>
     `,document.body.appendChild(t),this.addModalStyles(),setTimeout(()=>{t.classList.add("show")},10)}hideNewsModal(){let e=document.querySelector(".news-modal");e&&(e.classList.remove("show"),setTimeout(()=>{e.remove()},300))}addModalStyles(){var e;document.getElementById("news-modal-styles")||((e=document.createElement("style")).id="news-modal-styles",e.textContent=`
      .news-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease;
        padding: 16px;
        box-sizing: border-box;
      }
      
      .news-modal.show {
        opacity: 1;
      }
      
             .modal-content {
         background: white;
         border-radius: 12px;
         max-width: 600px;
         width: 100%;
         transform: scale(0.9);
         transition: transform 0.3s ease;
         box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
       }
       
       .modal-content--scrollable {
         max-height: 90vh;
         overflow-y: auto;
         scrollbar-width: thin;
         scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
       }
       
       .modal-content--no-scroll {
         max-height: none;
         overflow-y: visible;
       }
       
       .modal-content--scrollable::-webkit-scrollbar {
         width: 6px;
       }
       
       .modal-content--scrollable::-webkit-scrollbar-track {
         background: transparent;
       }
       
       .modal-content--scrollable::-webkit-scrollbar-thumb {
         background: rgba(0, 0, 0, 0.2);
         border-radius: 3px;
       }
       
       .modal-content--scrollable::-webkit-scrollbar-thumb:hover {
         background: rgba(0, 0, 0, 0.3);
       }
      
      .news-modal.show .modal-content {
        transform: scale(1);
      }
      
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding: 24px 24px 20px 24px;
        border-bottom: 1px solid #eee;
        position: sticky;
        top: 0;
        background: white;
        z-index: 1;
      }
      
      .modal-header h2 {
        margin: 0;
        color: #333;
        font-size: 24px;
        font-weight: 700;
        line-height: 1.3;
        flex: 1;
        padding-right: 16px;
      }
      
             .modal-close {
         background: none;
         border: none;
         font-size: 28px;
         cursor: pointer;
         color: #666;
         padding: 4px;
         border-radius: 50%;
         width: 40px;
         height: 40px;
         display: flex;
         align-items: center;
         justify-content: center;
         transition: all 0.2s ease;
         flex-shrink: 0;
         min-width: 40px;
         min-height: 40px;
       }
      
      .modal-close:hover {
        color: #333;
        background: rgba(0, 0, 0, 0.05);
      }
      
      .modal-body {
        padding: 24px;
      }
      
      .news-meta {
        margin-bottom: 20px;
        color: #666;
        font-size: 14px;
        font-weight: 500;
      }
      
      .news-content p {
        line-height: 1.7;
        color: #333;
        margin: 0;
        font-size: 16px;
      }

      /* Mobile styles for screens 540px and below */
      @media (max-width: 540px) {
        .news-modal {
          padding: 12px;
          align-items: flex-start;
          padding-top: 20px;
        }
        
                 .modal-content {
           border-radius: 16px;
           width: 100%;
         }
         
         .modal-content--scrollable {
           max-height: calc(100vh - 40px);
         }
         
         .modal-content--no-scroll {
           max-height: none;
         }
        
        .modal-header {
          padding: 20px 20px 16px 20px;
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
        }
        
        .modal-header h2 {
          font-size: 20px;
          line-height: 1.4;
          padding-right: 0;
        }
        
                 .modal-close {
           position: absolute;
           top: 16px;
           right: 16px;
           width: 36px;
           height: 36px;
           min-width: 36px;
           min-height: 36px;
           font-size: 24px;
           background: rgba(0, 0, 0, 0.1);
           color: #333;
         }
        
        .modal-close:hover {
          background: rgba(0, 0, 0, 0.15);
        }
        
        .modal-body {
          padding: 20px;
        }
        
        .news-meta {
          margin-bottom: 16px;
          font-size: 13px;
        }
        
        .news-content p {
          font-size: 15px;
          line-height: 1.6;
        }
      }

      /* Extra small screens */
      @media (max-width: 360px) {
        .news-modal {
          padding: 8px;
          padding-top: 16px;
        }
        
                 .modal-content {
           border-radius: 12px;
         }
         
         .modal-content--scrollable {
           max-height: calc(100vh - 32px);
         }
         
         .modal-content--no-scroll {
           max-height: none;
         }
        
        .modal-header {
          padding: 16px 16px 12px 16px;
        }
        
        .modal-header h2 {
          font-size: 18px;
        }
        
                 .modal-close {
           top: 12px;
           right: 12px;
           width: 32px;
           height: 32px;
           min-width: 32px;
           min-height: 32px;
           font-size: 20px;
         }
        
        .modal-body {
          padding: 16px;
        }
        
        .news-content p {
          font-size: 14px;
        }
      }
    `,document.head.appendChild(e))}}document.addEventListener("DOMContentLoaded",()=>{new NewsHandler});